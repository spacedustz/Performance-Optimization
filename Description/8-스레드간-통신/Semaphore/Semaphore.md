## Semaphore

세마포어는 멀티스레딩 환경에서 공유 자원에 대한 접근을 제어하기 위한 동기화 도구입니다.

**주어진 자원에 동시에 접근할 수 있는 스레드 수를 제한**하며, 카운터 값을 통해 이 접근을 관리합니다.

세마포어는 주로 Race Condition를 방지하고 자원의 일관성을 유지하는 데 사용됩니다.

리소스당 1개의 스레드만 허용하는 Lock과 달리 세마포어는 여러 사용자(스레드)에 권한을 부여하고 수를 제한할 수 있습니다.

<br>

간단히 요약하면 지난번 배운 ReentrantLock같은 Lock은 권한을 허용할 수 있는 개수가 1개인 세마포어라고 보면 되고,

이 글에서의 세마포어는 여러개의 권한을 허용/조절 할 수 있습니다.

`권한을 허용한다는 건 Resource에 Lock을 거는것과 같음`

---

## 기본적인 Semaphore 사용법

`Semaphore semaphore = new Semaphore(10);`

- Semaphore 객체를 생성하며, 초기 값으로 10을 설정합니다. 이 값은 동시에 허용할 수 있는 최대 스레드 수를 의미합니다.
- 즉, 최대 10개의 스레드가 자원에 접근할 수 있습니다.

<br>

`semaphore.acquire(5);`

- 세마포어로부터 5개의 권한을 요청합니다. 세마포어의 현재 남은 권한 수에서 5를 차감하게 되며, 이후 남은 권한 수는 5가 됩니다.
- 만약 남은 권한 수가 5보다 적다면, 해당 스레드는 권한이 해제될 때까지(다른 스레드가 release 호출) 대기하게 됩니다.

<br>

`useResource();`

- 공유 자원(resource)을 사용하는 코드가 실행됩니다.

<br>

`semaphore.release(5);`

- 사용한 5개의 권한을 세마포어에 반환합니다. 세마포어의 남은 권한 수는 다시 10이 되어, 다른 스레드가 자원에 접근할 수 있게 됩니다.

<br>

**만약 허가 가능한 수가 0인 세마포어에 acquire()를 호출하면?**

- 공유 자원을 사용중인 스레드가 세마포어를 release 할때까지 Thread가 Blocking 됩니다.

```java
Semaphore semaphore = new Semaphore(10);
semaphore.acquire(5);

useResource();

semaphore.release(5);
```
---

## Semaphore와 Lock의 차이점

**Semaphore는 소유자 스레드 개념이 없음**

- Lock 처럼 오직 1개의 스레드가 아닌 여러개의 스레드가 권한을 허가받기 떄문입니다.
- 그리고 스레드 하나가 Semaphore를 여러번 얻을수도 있습니다.
- 그래서 **초기값을 1로 맟춘 이진 세마포어는 Block 됩니다.**